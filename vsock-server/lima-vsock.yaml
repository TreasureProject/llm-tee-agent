# vsock.yaml
arch: "aarch64"

images:
  - location: "https://cloud-images.ubuntu.com/releases/22.04/release/ubuntu-22.04-server-cloudimg-arm64.img"
    arch: "aarch64"

mounts:
  - location: "~"
    writable: true

containerd:
  system: false
  user: false

cpus: 2
memory: 2GiB
disk: 20GiB

provision:
  - mode: system
    script: |
      #!/bin/bash
      set -eux -o pipefail
      # Setup VSOCK modules to load at boot
      tee /etc/modules-load.d/vsock.conf <<EOF
      vhost
      vsock
      vhost_vsock
      vmw_vsock_virtio_transport
      EOF
      # Load them now too
      modprobe vhost
      modprobe vsock
      modprobe vhost_vsock
      modprobe vmw_vsock_virtio_transport
